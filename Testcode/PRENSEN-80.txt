; Assume STATE_HI is in register a0, STATE_LO in a1
; Assume KEY_HI is in register a2, KEY_LO in a3

; XOR high 32 bits of STATE with high 32 bits of round key
xor a0, a0, a2  ; a0 now contains the result of STATE_HI XOR KEY_HI

; XOR low 32 bits of STATE with low 32 bits of round key
xor a1, a1, a3  ; a1 now contains the result of STATE_LO XOR KEY_LO

main:
0x00000293    addi t0, zero, 0               # t0: loop counter initialized to 0
0x00800313    addi t1, zero, 8               # t1: total number of nibbles in a 32-bit register
0x00000f93    addi t6, zero, 0    	   # t6: s-box base address 0x20

	addi t2, zero, 0
	sb t6, 0xC(t2)	           # This section can be store in the RAM advance
	addi t2, zero, 4
	sb t6, 0x5(t2)
	


    sb 0x5, 4(t6)
    sb 0x6, 8(t6)
    sb 0xB, 12(t6)
    sb 0x9, 16(t6)
    sb 0x0, 20(t6)
    sb 0xA, 24(t6)
    sb 0xD, 28(t6)
    sb 0x3, 32(t6)
    sb 0xE, 36(t6)
    sb 0xF, 40(t6)
    sb 0x8, 44(t6)
    sb 0x4, 48(t6)
    sb 0x7, 52(t6)
    sb 0x1, 56(t6)
    sb 0x2, 60(t6)

loop:
    # Shift right to bring the current nibble to the least significant position
    srl t2, a0, t0         # t2: holds the current nibble
    andi t2, t2, 0xF       # Isolate the current nibble

    # Apply S-box
    add t6, t6, t2         # t6: address of the S-box entry for the current nibble
    lbu t2, 0(t6)          # t2: S-box substitution for the current nibble

    # Clear the current nibble in a0 and insert the substituted nibble
    sll t4, t2, t0         # Align the substituted nibble back to its original position
    li t5, 0xF             # t5: nibble mask
    sll t5, t5, t0         # Align the mask
    not t5, t5             # Invert the mask
    and a0, a0, t5         # Clear the nibble in a0
    or a0, a0, t4          # Insert the substituted nibble

    # Update the loop counter
    addi t0, t0, 4         # Move to the next nibble
    blt t0, t1, loop       # Continue looping if t0 < 8